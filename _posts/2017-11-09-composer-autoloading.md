---
layout: post
title: Autoloading کلاس ها با Composer
date:   2017-11-09 10:01:42 +0330
jdate: پنج شنبه 18 آبان 1396
categories: articles
#  permalink: /:categories/:title.html
thumbnail: maxresdefault.jpg
refrence: https://alihossein.ir/tutorials/آموزش-autoloading-کلاس-compose <br> http://vegibit.com/composer-autoloading-tutorial/
---


 <p>
  همانطور که می دانیم در php برای استفاده از هر کلاسی باید اون کلاس رو در صفحه ای که لازم داریم include یا require کنیم تا php آن کلاس را بشناسد و بتوان از آن استفاده کرد . خب مشکل اینجاست که اگر تعداد کلاس های مورد استفاده زیاد شود این include کردن هر کلاس واقعا مشکل ساز میشه و تمرکز مارو کم می کنه و بیشتر وقتمون میره سمت اینکه کلاس ها در داخل کدام دایرکتوری هستند و تک تک آن ها را به صفحه ی خودمون include کنیم .
 </p>

 <p>
خوشبختانه composer این مشکل را برای ما حل کرده و خودش این موضوع را به عهده می گیرد و ما فقط کافی است بسته به نیازمون یکی از 3 روش زیر را که در فایل composer.json می باشد استفاده نماییم . داخل فایل composer آبجکتی به نام&nbsp;autoload وجود دارد که داخل آن تعریف می کنیم که چه فایل هایی را و از چه طریق برای ما autoload بسازد.
</p>

<p>3روش autoloading در composer عبارتند از :</p>
<ul>
<li><a class="anchorjs" title="روش-file-based-autoloading" href="#" >File Based Autoloading</a></li>
<li><a class="anchorjs" title="روش-classmap-based-autoloading" href="#" >Classmap Based Autoloading</a></li>
<li><a class="anchorjs" title="روش-psr-4-based-autoloading" href="#" >PSR-4 Autoloading</a></li>
</ul>
<p>سایت اصلی composer روش&nbsp;PSR-4 Autoloading را پیشنهاد می کند اما ما در این مقاله &nbsp;هر 4 روش را بررسی می نماییم .</p>


<h3>روش File Based Autoloading</h3>

<p>
<ol>
<li>در روت (root) پروژه خودتون یک فولدر به نامaldemo ایجاد کنید .</li>
<li>سپس داخل فولدرaldemo یک فولدر دیگر به نام&nbsp;mylibrary ایجاد می کنیم تا فایل های خودمون را داخل اش قرار بدهیم .</li>
<li>داخل فولدر&nbsp;mylibrary یک فایل به نام&nbsp;functions.php ایجاد و کدهای زیر را قرار دهید :
<pre><code class="language-php line-numbers"><?php

function lego () {
    return 'You are now a master builder.';
}
</code></pre>
</li>
<li>حالا داخل فولدر(aldemo) پروژه امون فایل composer.json را ایجاد و کدهای زیر را قرار می دهیم :
<pre><code class="language-json line-numbers">{
    "autoload": {
        "files": ["mylibrary/functions.php"]
    }
}
</code></pre>
</li>
<li>همانطور که در بالا مشاهده می کنید یک آبجکت به نام autoload داریم و داخل آن &nbsp;مشخص کردیم که به چه روشی&nbsp;autoload برای ما ساخته شود . ما روش files را تعیین کردیم و جلوی آن فایل هایی که قرار است به صورت&nbsp;autoload درآیند  را بصورت عناصر آرایه  مشخص می کنیم .</li>
<li>حالا برای ایجاد autoload باید ترمینال را باز کرده و به روت پروژه بروید و یکی از دستورات زیر را اجرا کنید :
<pre><code class="language-bash line-numbers">
composer dump
یا
composer dumpautoload
</code></pre>

<p>
بعد از اجرای فرمان بالا و زدن دکمه اینتر مشاهده می کنید که در روت پروژه , فولدری به نام vendor ساخته می شود .جهت مشاهده تغییرات وارد پوشه  vendor سپس پوشه composer شده و   فایل autoload_files.php را باز نمائید.
</p>

<pre><code class="language-php line-numbers"><?php
// autoload_files.php @generated by Composer

$vendorDir = dirname(dirname(__FILE__));
$baseDir = dirname($vendorDir);

return array(
    '239a881d87672da709af2b939c130dab' => $baseDir . '/mylibrary/functions.php',
);
</code></pre>

<p>
در خط 8 مشاهده می کنید مسیر فایل function.php به این فایل افزوده شده است.
</p>


</li>
<li>اگر تمام مراحل بالا به درستی انجام شده باشد, فرایند ساخت autoload به وسیله composer و از روش files به موفقیت به اتمام رسیده است . حالا برای استفاده از فایل function.php کافی است در فولدر aldemo فایلی به نام index.php ایجاد کنید و کدهای زیر را قرار دهید :
<pre><code class="language-php line-numbers"><?php
require 'vendor/autoload.php';
echo lego();
</code></pre>
</li>

در کدهای بالا در خط اول لازم بود که autoload.php را به فایل index امان require کنید . و در خط بعدی از فانکشن lego که در فایل function.php موجود هست استفاده کردیم .

</ol>
</p>


<h3>روش Classmap Based Autoloading</h3>
<p>
این روش از روش File Based Autoloading بهتر است به این خاطر که شما لازم نیست مسیر واقعی فایل خود را مشخص کنید و تنها دایرکتوری که فایل در آن قرار دارد را مشخص می کنیم.
</p>
<p>
نکته : در این روش فقط می توان از کلاس ها استفاده نمود .
</p>
<p>
<ol>
<li>
فولدری به نام classes در شاخه aldemo ایجاد نمائید.سپس فایل myclass.php را در آن ایجاد و کدهای زیر را در آن قرار دهید :
<pre><code class="language-php line-numbers"><?php
Class Cmautoload {
 
	  public function classmap () {
		  return 'that knows how to autoload with a classmap! ';
	  }
}
</code></pre>

</li>

<li>
فایل index.php  را مطابق زیر تغییر دهید :

<pre><code class="language-php line-numbers"><?php
 
require 'vendor/autoload.php';
 
echo lego();
 
$cm = new Cmautoload;
echo $cm->classmap();
</code></pre>
</li>


<li>
فایل composer.json  را مطابق زیر تغییر دهید :

<pre><code class="language-json line-numbers">{
    "autoload": {
        "files": [
			"mylibrary/functions.php"
		],
		"classmap": [
			"classes"
		]
	}
}
</code></pre>
</li>

<li>حالا برای ایجاد autoload باید ترمینال را باز کرده و به روت پروژه بروید و یکی از دستورات زیر را اجرا کنید :
<pre><code class="language-bash line-numbers">
composer dump
یا
composer dumpautoload
</code></pre>
<p>
جهت مشاهده تغییرات وارد پوشه vendor سپس پوشه composer شده و فایل autoload_classmap.php را باز نمائید.
</p>
<pre><code class="language-php line-numbers"><?php

// autoload_classmap.php @generated by Composer

$vendorDir = dirname(dirname(__FILE__));
$baseDir = dirname($vendorDir);

return array(
    'Cmautoload' => $baseDir . '/classes/myclass.php',
);

</code></pre>
<p>
در خط شماره 9 مشاهده می کنید مسیر کلیه کلاس های موجود در پوشه classes  افزوده شده است.
</p>
</li>
</ol>
</p>


<h3>روش PSR-4 Based Autoloading</h3>
<p>
استاندارد psr-4 بر خلاف دو روش قبلی یعنی File Based Autoloading , Classmap Based Autoloading با namespace ها در کلاس ها سرو کار دارد .
</p>
<p>
<ol>
<li><p>
مسیر زیر را در پروژه خود ایجاد نمائید:
</p>
<p align="left">
src/vegibit/library
</p>
</li>
<li>
فایل greeting.php را در مسیر بالا ایجاد و کدهای زیر را در آن قرار دهید:
<pre><code class="language-php line-numbers"><?php
namespace VegibitLibrary;
 
Class Greeting
{
    public function hi()
    {
        return "We got you covered";
    }
}

</code></pre>
</li>


<li>
<p>
فایل index.php  را مطابق زیر تغییر دهید :
</p>

<pre><code class="language-php line-numbers"><?php
 
require 'vendor/autoload.php';
 
echo lego();
 
$cm = new Cmautoload;
echo $cm->classmap();
 
$obj = new VegibitLibrary\Greeting();

echo $obj->hi();
</code></pre>
</li>

<li>
فایل composer.json را مطابق زیر تغییر دهید:

<pre><code class="language-json line-numbers">
{
    "autoload": {
        "files": [
			"mylibrary/functions.php"
		],
		"classmap": [
			"classes"
		],
		"psr-4": {
			"VegibitLibrary\\" : "src/vegibit/library/"
		}
	}
}
</code></pre>
</li>

<li>حالا برای ایجاد autoload باید ترمینال را باز کرده و به روت پروژه بروید و یکی از دستورات زیر را اجرا کنید :
<pre><code class="language-bash line-numbers">
composer dump
یا
composer dumpautoload
</code></pre>
<p>
جهت مشاهده تغییرات وارد پوشه vendor سپس پوشه composer شده و فایل autoload_psr4.php را باز نمائید.
</p>
<pre><code class="language-php line-numbers"><?php

// autoload_psr4.php @generated by Composer

$vendorDir = dirname(dirname(__FILE__));
$baseDir = dirname($vendorDir);

return array(
    'VegibitLibrary\\' => array($baseDir . '/src/vegibit/library'),
);


</code></pre>
<p>
در خط شماره 9 مشاهده می کنید آدرس فضای نام VegibitLibrary بصورت عنصر آرایه  افزوده شده است.
</p>
</li>
</ol>
</p>
<br>
<p>
کلیه فایل های بالا را می توانید از لینک زیر دانلود نمایید:
</p>
<p align="left">
<a href="/files/aldemo.zip">aldemo.zip</a>
</p>


